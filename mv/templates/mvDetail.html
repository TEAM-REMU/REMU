{% extends 'base.html' %} {% load static %} {% block head %}
<link rel="stylesheet" href="{% static 'css/mvDetail.css' %}" />
{% endblock %} {% block contents %}
<div id="mvDetailContainer">
  <div class="videoDetail">
    <div id="videoContainer">
      <iframe id="video" src="//www.youtube.com/embed/{{video.video_link}}" frameborder="0"
        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
    <h1 class="videoInformation">{{video.title}}</h1>
    <div class="videoInformation directorDetail">
      <span>{{video.director.name}} 감독</span>
      <a><button>감독 프로필 확인하기</button></a>
    </div>
    <div class="videoInformation">아티스트 : {{video.artist}}</div>
    <div class="videoInformation">업로드 날짜 : {{video.upload_date|date:"Y년 m월 d일"}}</div>
    <div class="videoInformation score">
      <span id="mvStar" class="rating middle" data-stars="5" data-default-rating="3.5" disabled></span>
      <div>
        (4.8/5.0)
      </div>
    </div>
  </div>
  <div class="commentWriter">
    <!-- 로그인 기능 추가하면 if에 not 추가 -->
    {% if request.user.is_authenticated %}
    <span id="myStar" class="rating big" data-stars="5" data-default-rating="3"></span>
    <textarea rows="8" placeholder="뮤비에 대한 리뷰를 작성해주세요."></textarea>
    <div class="buttonContainer">
      <button>기록하기</button>
    </div>
    {% else %}
    <span id="myStar" class="rating big" data-stars="5" data-default-rating="3" disabled></span>
    <textarea rows="8" placeholder="로그인을 해야 리뷰를 작성할 수 있습니다" disabled></textarea>
    <div class="buttonContainer">
      <button disabled>기록하기</button>
    </div>
    {% endif %}
  </div>
  <div class="commentContainer">
    {% for review in video.reviews.all %}
    <div class="review">
      <div class="reviewAuthor">
        <div class="profileBox">
          <img src="{% static 'img/pruple.png' %}" />
          <div class="reviewAuthorName">{{review.author.profile.name}}</div>
        </div>
        <span class="rating" data-stars="5" data-default-rating={{review.score}} disabled></span>
      </div>
      <div class="reviewComment">
        {{review.text}}
      </div>
      <div class="reviewDetail">
        {{review.register_date|date:"Y년 m월 d일"}}
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
{% block script %}
<script>
  // rating 속성의 요소를 모두 얻어서
  let ratings = document.getElementsByClassName('rating');
  // star로 만들어버림
  let r = [...ratings].map(star => new SimpleStarRating(star))
  // 사용자가 평가하는 별점의 경우 이벤트 추가
  let myRating = document.getElementById('myStar');
  myRating.addEventListener('rate', function (e) {
    console.log(e.detail)
  });
</script>
{% endblock %}